<div class="d-flex justify-content-center align-items-center min-vh-100 bg-light">
  <div class="card shadow-lg p-4 rounded-4" style="width: 100%; max-width: 420px;">
    <div class="card-body">
      <h4 class="text-center mb-3 text-primary fw-bold">ğŸ” Nueva ContraseÃ±a</h4>

      <p class="text-muted text-center mb-4" style="font-size: 0.95rem;">
        Ingresa y confirma tu nueva contraseÃ±a para restablecer el acceso a tu cuenta.
      </p>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" *ngIf="token" novalidate>

        <!-- NUEVA CONTRASEÃ‘A -->
        <div class="mb-3 position-relative">
          <label for="newPassword" class="form-label fw-semibold">Nueva contraseÃ±a</label>
          <input
            id="newPassword"
            [type]="showPassword ? 'text' : 'password'"
            class="form-control"
            formControlName="newPassword"
            [ngClass]="{
              'is-invalid': f['newPassword'].touched && f['newPassword'].invalid,
              'is-valid': f['newPassword'].touched && f['newPassword'].valid
            }"
            placeholder="********"
          />

          <!-- Ojito -->
          <i class="bi"
             [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"
             (click)="showPassword = !showPassword"
             style="position: absolute; top: 38px; right: 12px; cursor: pointer;"></i>

          <div *ngIf="f['newPassword'].touched && f['newPassword'].invalid" class="invalid-feedback">
            La contraseÃ±a debe tener al menos 8 caracteres.
          </div>
        </div>

        <!-- CONFIRMAR CONTRASEÃ‘A -->
        <div class="mb-3 position-relative">
          <label for="confirmPassword" class="form-label fw-semibold">Confirmar contraseÃ±a</label>
          <input
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            class="form-control"
            formControlName="confirmPassword"
            [ngClass]="{
              'is-invalid': f['confirmPassword'].touched && form.hasError('mismatch'),
              'is-valid': f['confirmPassword'].touched && !form.hasError('mismatch')
            }"
            placeholder="********"
          />

          <!-- Ojito -->
          <i class="bi"
             [ngClass]="showConfirmPassword ? 'bi-eye-slash' : 'bi-eye'"
             (click)="showConfirmPassword = !showConfirmPassword"
             style="position: absolute; top: 38px; right: 12px; cursor: pointer;"></i>

          <div *ngIf="f['confirmPassword'].touched && form.hasError('mismatch')" class="invalid-feedback">
            Las contraseÃ±as no coinciden.
          </div>
          <div *ngIf="f['confirmPassword'].touched && !form.hasError('mismatch')" class="valid-feedback">
            âœ… Las contraseÃ±as coinciden.
          </div>
        </div>

        <!-- BOTÃ“N -->
        <button type="submit" class="btn btn-success w-100 fw-bold" [disabled]="loading || form.invalid">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          {{ loading ? 'Procesando...' : 'Cambiar contraseÃ±a' }}
        </button>
      </form>

      <!-- MENSAJE DE TOKEN INVÃLIDO -->
      <div *ngIf="!token" class="alert alert-danger text-center mt-3" role="alert">
        âŒ El enlace es invÃ¡lido o ha expirado. Por favor solicita una nueva recuperaciÃ³n.
      </div>

      <!-- MENSAJES -->
      <div *ngIf="successMessage" class="alert alert-success mt-3" role="alert">
        {{ successMessage }}
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger mt-3" role="alert">
        {{ errorMessage }}
      </div>
    </div>
  </div>
</div>
