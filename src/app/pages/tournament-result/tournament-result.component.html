<div class="container mt-4">
  <!-- Botón Atrás -->
  <button class="btn btn-outline-secondary mb-3" (click)="goBack()">
    <i class="fas fa-arrow-left me-2"></i> Volver
  </button>

  <!--INFORMACIÓN GENERAL DEL TORNEO COMPLETA -->
  <div class="card shadow-sm border-0 rounded-4 mb-4 tournament-info-card">
    <div class="row g-0 align-items-center flex-column flex-md-row">

      <!-- Logo -->
      <div class="col-md-3 text-center p-3 p-md-4">
        <img [src]="selectedTournament?.imageUrl || 'assets/img/clubDefault.png'"
          (error)="onImgError($event, 'assets/img/clubDefault.png')" alt="Logo torneo"
          class="img-fluid rounded-circle border shadow-sm" width="120" height="120" />
      </div>

      <!-- Información del torneo -->
      <div class="col-md-9 p-3 p-md-4">
        <h2 class="fw-bold mb-3 text-primary tournament-title">
          {{ selectedTournament?.name || 'Nombre del Torneo' }}
        </h2>

        <div class="row gy-2 gy-md-2 text-muted">
          <div class="col-6 col-md-6">
            <i class="fas fa-calendar-alt text-warning me-2"></i>
            <strong>Inicio:</strong> <span class="d-block d-md-inline">{{ selectedTournament?.startDate |
              date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="col-6 col-md-6">
            <i class="fas fa-calendar-check text-success me-2"></i>
            <strong>Fin:</strong> <span class="d-block d-md-inline">{{ selectedTournament?.endDate | date:'dd/MM/yyyy'
              }}</span>
          </div>

          <div class="col-6 col-md-6">
            <i class="fas fa-map-marker-alt text-danger me-2"></i>
            <strong>Ubicación:</strong> <span class="d-block d-md-inline">{{ selectedTournament?.location || 'No
              especificada' }}</span>
          </div>
          <div class="col-6 col-md-6">
            <i class="fas fa-user text-primary me-2"></i>
            <strong>Organizador:</strong> <span class="d-block d-md-inline">{{ selectedTournament?.organizer || 'N/D'
              }}</span>
          </div>

          <div class="col-6 col-md-6">
            <i class="fas fa-globe text-info me-2"></i>
            <strong>Ámbito:</strong> <span class="d-block d-md-inline">{{ selectedTournament?.ambitName || '-' }}</span>
          </div>
          <div class="col-6 col-md-6">
            <i class="fas fa-info-circle text-secondary me-2"></i>
            <strong>Estado:</strong>
            <span class="badge d-block d-md-inline mt-1 mt-md-0"
              [ngClass]="selectedTournament?.status ? 'text-bg-success' : 'text-bg-secondary'">
              {{ selectedTournament?.status ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
        </div>

        <!-- Categorías, Modalidades y Ramas -->
        <div class="mt-4 row gy-2">
          <div class="col-12 col-md-4">
            <i class="fas fa-layer-group text-primary me-2"></i>
            <strong>Categorías:</strong>
            <span class="d-block d-md-inline">
              <span *ngIf="categories.length; else noCat">
                <span *ngFor="let cat of categories; let i = index">
                  {{ cat.name }}<span *ngIf="i < categories.length - 1">, </span>
                </span>
              </span>
              <ng-template #noCat><em class="text-muted">Ninguna</em></ng-template>
            </span>
          </div>

          <div class="col-12 col-md-4">
            <i class="fas fa-puzzle-piece text-success me-2"></i>
            <strong>Modalidades:</strong>
            <span class="d-block d-md-inline">
              <span *ngIf="modalities.length; else noMod">
                <span *ngFor="let mod of modalities; let i = index">
                  {{ mod.name }}<span *ngIf="i < modalities.length - 1">, </span>
                </span>
              </span>
              <ng-template #noMod><em class="text-muted">Ninguna</em></ng-template>
            </span>
          </div>

          <div class="col-12 col-md-4">
            <i class="fas fa-venus-mars text-danger me-2"></i>
            <strong>Ramas:</strong>
            <span class="d-block d-md-inline">
              <span *ngIf="branches.length; else noBranch">
                <span *ngFor="let branch of branches; let i = index">
                  {{ branch.name }}<span *ngIf="i < branches.length - 1">, </span>
                </span>
              </span>
              <ng-template #noBranch><em class="text-muted">Ninguna</em></ng-template>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JUGADORES INSCRITOS -->
  <div class="card shadow-sm mb-4 border-0 players-section">
    <div class="card-body p-3 p-md-4">
      <div
        class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
        <h4 class="fw-bold text-secondary mb-0">Jugadores Inscritos Por Modalidad</h4>
        <div class="d-flex flex-column flex-lg-row gap-2 w-100 w-md-auto">
          <!-- Inputs ocultos -->
          <input type="file" #fileInput accept=".xlsx,.xls,.csv" (change)="onPlayersFileSelected($event)" hidden />

          <input type="file" #fileTeamInput accept=".xlsx,.xls,.csv" (change)="onTeamPersonFileSelected($event)"
            hidden />

          <!-- Botones -->
          <button class="btn btn-outline-primary btn-sm flex-grow-1" (click)="fileInput.click()"
            [disabled]="isUploadingPlayers">
            <i class="fas fa-file-excel me-1"></i>
            <span class="d-none d-sm-inline">{{ isUploadingPlayers ? 'Subiendo...' : 'Cargar jugadores' }}</span>
            <span class="d-sm-none">{{ isUploadingPlayers ? 'Subiendo...' : 'Jugadores' }}</span>
          </button>

          <button class="btn btn-outline-warning btn-sm flex-grow-1" (click)="fileTeamInput.click()"
            [disabled]="loading">
            <i class="fas fa-users me-1"></i>
            <span class="d-none d-sm-inline">Cargar Equipos</span>
            <span class="d-sm-none">Equipos</span>
          </button>

          <button class="btn btn-success btn-sm flex-grow-1" (click)="openModal(modalPlayerRef)">
            <i class="fas fa-plus-circle me-1"></i> <span class="d-none d-sm-inline">Nuevo Jugador</span><span
              class="d-sm-none">Jugador</span>
          </button>

          <button class="btn btn-success btn-sm flex-grow-1" (click)="openModal(modalTeamRef)">
            <i class="fas fa-plus-circle me-1"></i> <span class="d-none d-sm-inline">Nuevo Equipo</span><span
              class="d-sm-none">Equipo</span>
          </button>

        </div>
      </div>

      <!-- Filtros jugadores -->
      <div class="row g-2 g-md-3 mb-3">
        <div class="col-12 col-md-10">
          <p class="form-p">Rama</p>
          <select class="form-select form-select-sm" [(ngModel)]="selectedBranchPlayer"
            (change)="onFilterPlayerChange()">
            <option value="">Todas</option>
            <option *ngFor="let b of branches" [value]="b.name">{{ b.name }}</option>
          </select>
        </div>
        <div class="col-12 col-md-2">
          <p class="form-p">.</p>
          <button class="btn btn-outline-secondary btn-sm w-100" (click)="clearPlayerFilters()">
            <i class="fas fa-eraser me-1"></i> Limpiar
          </button>
        </div>
      </div>

      <!-- Tabla jugadores -->
      <div class="table-responsive players-table-wrapper">
        <table class="table table-hover table-sm align-middle text-center border players-table">
          <thead class="table-light">
            <tr class="fw-bold">
              <th>#</th>
              <th>Nombre</th>
              <th class="d-none d-md-table-cell">Categoría</th>
              <th class="d-none d-lg-table-cell">Modalidad</th>
              <th class="d-none d-md-table-cell">Rama</th>
              <th class="d-none d-lg-table-cell">Equipo</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody *ngIf="groupedRegistrations.length > 0; else noPlayers">
            <ng-container *ngFor="let group of groupedRegistrations">
              <!-- Encabezado de modalidad -->
              <tr class="table-secondary fw-bold text-start">
                <td [attr.colspan]="7">
                  <i class="fas fa-bowling-ball me-2"></i> {{ group.modality }}
                </td>
              </tr>

              <!-- Jugadores de esa modalidad -->
              <tr *ngFor="let p of group.players; let i = index">
                <td>{{ i + 1 }}</td>
                <td class="text-start">{{ p.personFullName || '-' }}</td>
                <td class="d-none d-md-table-cell small">{{ p.categoryName || '-' }}</td>
                <td class="d-none d-lg-table-cell small">{{ p.modalityName || '-' }}</td>
                <td class="d-none d-md-table-cell small">{{ p.branchName || '-' }}</td>
                <td class="d-none d-lg-table-cell small">{{ p.teamName || 'N/A' }}</td>
                <td>
                  <div class="d-flex justify-content-center gap-1">
                    <button class="btn btn-outline-primary btn-sm" (click)="editPlayer(p)" title="Editar">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-danger btn-sm" (click)="deletePlayer(p.registrationId)"
                      title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>

          <ng-template #noPlayers>
            <tr>
              <td colspan="7" class="text-muted py-3 text-center">No hay jugadores cargados.</td>
            </tr>
          </ng-template>

        </table>
      </div>
    </div>
  </div>

  <!--  RESULTADOS -->
  <div class="card shadow-sm border-0 results-section">
    <div class="card-body p-3 p-md-4">
      <div
        class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
        <h4 class="fw-bold text-secondary mb-0">Resultados del Torneo</h4>
        <div class="d-flex flex-column flex-md-row gap-2 w-100 w-md-auto">
          <!-- Input de archivo oculto -->
          <input type="file" #fileResultInput accept=".xlsx,.xls,.csv" (change)="onResultFileSelected($event)" hidden />

          <!-- Botón de carga -->
          <button class="btn btn-outline-primary btn-sm flex-grow-1" (click)="fileResultInput.click()"
            [disabled]="isUploadingResults">
            <i class="fas fa-file-excel me-1"></i>
            <span class="d-none d-sm-inline">{{ isUploadingResults ? 'Subiendo...' : 'Cargar Resultados' }}</span>
            <span class="d-sm-none">{{ isUploadingResults ? 'Subiendo...' : 'Resultados' }}</span>
          </button>

          <button class="btn btn-success btn-sm flex-grow-1" (click)="openModal(modalResultRef)">
            <i class="fas fa-plus-circle me-1"></i> <span class="d-none d-sm-inline">Nuevo Resultado</span><span
              class="d-sm-none">Resultado</span>
          </button>
        </div>
      </div>

      <!-- Filtros -->
      <div class="row g-2 g-md-3 mb-3">
        <div class="col-12 col-md-5">
          <p class="form-p">Rama</p>
          <select class="form-select form-select-sm" [(ngModel)]="selectedBranch" (change)="onFilterChange()">
            <option value="">Todas</option>
            <option *ngFor="let b of branches" [value]="b.name">{{ b.name }}</option>
          </select>
        </div>
        <div class="col-12 col-md-5">
          <p class="form-p">Ronda</p>
          <select class="form-select form-select-sm" [(ngModel)]="selectedRound" (change)="onFilterChange()">
            <option [ngValue]="null">Todas</option>
            <option *ngFor="let r of roundNumbers" [ngValue]="r">{{ r }}</option>
          </select>
        </div>
        <div class="col-12 col-md-2">
          <p class="form-p">.</p>
          <button class="btn btn-outline-secondary btn-sm w-100" (click)="clearFilters()">
            <i class="fas fa-eraser me-1"></i> Limpiar
          </button>
        </div>
      </div>

      <!-- Tabla resultados -->
      <div class="table-responsive results-table-wrapper">
        <table class="table table-hover table-sm align-middle text-center border results-table">
          <thead class="table-light">
            <tr class="fw-bold">
              <th>ID</th>
              <th class="d-none d-sm-table-cell">Torneo</th>
              <th class="d-none d-lg-table-cell">Categoría</th>
              <th class="d-none d-lg-table-cell">Modalidad</th>
              <th class="d-none d-md-table-cell">Rama</th>
              <th>Ronda</th>
              <th>Jugador</th>
              <th class="d-none d-lg-table-cell">Equipo</th>
              <th>Pista</th>
              <th class="d-none d-md-table-cell">Línea</th>
              <th>Puntaje</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let result of filteredResults">
              <td class="small">{{ result.resultId }}</td>
              <td class="d-none d-sm-table-cell small">{{ result.tournamentName || selectedTournament?.name || '-' }}
              </td>
              <td class="d-none d-lg-table-cell small">{{ result.categoryName || '-' }}</td>
              <td class="d-none d-lg-table-cell small">{{ result.modalityName || '-' }}</td>
              <td class="d-none d-md-table-cell small">{{ result.branchName || '-' }}</td>
              <td>{{ result.roundNumber || '-' }}</td>
              <td class="text-start small">{{ result.personName || '-' }}</td>
              <td class="d-none d-lg-table-cell small">{{ result.teamName || '-' }}</td>
              <td>{{ result.laneNumber || '-' }}</td>
              <td class="d-none d-md-table-cell small">{{ result.lineNumber || '-' }}</td>
              <td class="fw-bold">{{ result.score || '-' }}</td>
              <td>
                <div class="d-flex justify-content-center gap-1">
                  <button class="btn btn-outline-primary btn-sm" (click)="editResult(result)" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" (click)="deleteResult(result.resultId)"
                    title="Eliminar">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="!filteredResults.length">
              <td [attr.colspan]="12" class="text-muted py-3">No hay resultados disponibles.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Modal: Nuevo Jugador -->
<ng-template #modalPlayer>
  <div class="modal-content">
    <div class="modal-header bg-primary text-white">
      <h5 class="modal-title">{{ idPlayer ? 'Editar' : 'Nuevo' }} Jugador</h5> <button type="button"
        class="btn-close btn-close-white" aria-label="Close" (click)="closeModal()"></button>
    </div>
    <form [formGroup]="playerForm" (ngSubmit)="savePlayer()">
      <div class="modal-body">
        <div class="row g-3">
          <!-- Persona -->
          <div class="col-md-6">
            <p class="form-p">Persona *</p> <select class="form-select form-select-sm" formControlName="personId"
              [ngClass]="{ 'is-invalid': playerForm.controls['personId'].invalid && playerForm.controls['personId'].touched, 'is-valid': playerForm.controls['personId'].valid }">
              <option [ngValue]="null" disabled>Seleccione persona</option>
              <option *ngFor="let player of players" [ngValue]="player.personId"> {{ player.fullName }} {{
                player.fullSurname }} </option>
            </select>
            <div class="invalid-feedback"
              *ngIf="playerForm.controls['personId'].invalid && playerForm.controls['personId'].touched"> Debe
              seleccionar una persona. </div>
          </div>
          <!-- Categoría -->
          <div class="col-md-6">
            <p class="form-p">Categoría *</p> <select class="form-select form-select-sm" formControlName="categoryId"
              [ngClass]="{ 'is-invalid': playerForm.controls['categoryId'].invalid && playerForm.controls['categoryId'].touched, 'is-valid': playerForm.controls['categoryId'].valid }">
              <option [ngValue]="null" disabled>Seleccione categoría</option>
              <option *ngFor="let cat of selectedTournament?.categories" [ngValue]="cat.categoryId"> {{ cat.name }}
              </option>
            </select>
            <div class="invalid-feedback"
              *ngIf="playerForm.controls['categoryId'].invalid && playerForm.controls['categoryId'].touched"> Debe
              seleccionar una categoría. </div>
          </div>
          <!-- Modalidad -->
          <div class="col-md-6">
            <p class="form-p">Modalidad *</p> <select class="form-select form-select-sm" formControlName="modalityId"
              [ngClass]="{ 'is-invalid': playerForm.controls['modalityId'].invalid && playerForm.controls['modalityId'].touched, 'is-valid': playerForm.controls['modalityId'].valid }">
              <option [ngValue]="null" disabled>Seleccione modalidad</option>
              <option *ngFor="let mod of selectedTournament?.modalities" [ngValue]="mod.modalityId"> {{ mod.name }}
              </option>
            </select>
            <div class="invalid-feedback"
              *ngIf="playerForm.controls['modalityId'].invalid && playerForm.controls['modalityId'].touched"> Debe
              seleccionar una modalidad. </div>
          </div>
          <!-- Rama -->
          <div class="col-md-6">
            <p class="form-p">Rama *</p> <select class="form-select form-select-sm" formControlName="branchId"
              [ngClass]="{ 'is-invalid': playerForm.controls['branchId'].invalid && playerForm.controls['branchId'].touched, 'is-valid': playerForm.controls['branchId'].valid }">
              <option [ngValue]="null" disabled>Seleccione rama</option>
              <option *ngFor="let branch of selectedTournament?.branches" [ngValue]="branch.branchId"> {{ branch.name
                }}
              </option>
            </select>
            <div class="invalid-feedback"
              *ngIf="playerForm.controls['branchId'].invalid && playerForm.controls['branchId'].touched"> Debe
              seleccionar una rama. </div>
          </div>
          <div class="col-md-6">
            <p class="form-p">Estado *</p> <select class="form-select form-select-sm" formControlName="status"
              [ngClass]="{ 'is-invalid': playerForm.controls['status'].invalid && playerForm.controls['status'].touched, 'is-valid': playerForm.controls['status'].valid }">
              <option [ngValue]="null" disabled>Seleccione...</option>
              <option *ngFor="let st of estados" [ngValue]="st.valor">{{ st.etiqueta }}</option>
            </select>
            <div class="invalid-feedback"
              *ngIf="playerForm.controls['status'].invalid && playerForm.controls['status'].touched"> Debe seleccionar
              un estado. </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">Cancelar</button>
          <button type="button" class="btn btn-success" [disabled]="playerForm.invalid"
            (click)="savePlayer()">Guardar</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>


<!-- Modal: Nuevo Equipo -->
<ng-template #modalTeam>
  <div class="modal-content">
    <div class="modal-header bg-primary text-white">
      <h5 class="modal-title">Nuevo Equipo</h5>
      <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="closeModal()"></button>
    </div>

    <form [formGroup]="teamForm" (ngSubmit)="saveTeam()">
      <div class="modal-body">
        <div class="row g-3">

          <!-- Nombre del equipo -->
          <div class="col-md-6">
            <p class="form-p">Nombre del Equipo *</p>
            <input type="text" formControlName="nameTeam" class="form-control form-control-sm"
              [ngClass]="{ 'is-invalid': teamForm.controls['nameTeam'].invalid && teamForm.controls['nameTeam'].touched }" />
            <div class="invalid-feedback"
              *ngIf="teamForm.controls['nameTeam'].invalid && teamForm.controls['nameTeam'].touched">
              Nombre obligatorio.
            </div>
          </div>

          <!-- Teléfono del equipo -->
          <div class="col-md-6">
            <p class="form-p">Teléfono (opcional)</p>
            <input type="text" formControlName="phone" class="form-control form-control-sm" />
          </div>

          <!-- Seleccionar jugadores -->
          <div class="col-md-12">
            <p class="form-p">Seleccionar Jugadores *</p>
            <ng-select [items]="players" bindLabel="fullName" bindValue="personId" [multiple]="true"
              formControlName="playerIds" class="form-select form-select-sm" [ngClass]="{
      'is-invalid': teamForm.controls['playerIds'].invalid && teamForm.controls['playerIds'].touched,
      'is-valid': teamForm.controls['playerIds'].valid
    }">
              <ng-template ng-option-tmp let-player="item">
                {{ player.fullName }} {{ player.fullSurname }}
              </ng-template>
            </ng-select>

            <div class="invalid-feedback"
              *ngIf="teamForm.controls['playerIds'].invalid && teamForm.controls['playerIds'].touched">
              Seleccione al menos 2 jugadores.
            </div>
          </div>

          <!-- Categoría -->
          <div class="col-md-6">
            <p class="form-p">Categoría *</p>
            <select formControlName="categoryId" class="form-select form-select-sm">
              <option [ngValue]="null" disabled>Seleccione categoría</option>
              <option *ngFor="let cat of selectedTournament?.categories" [ngValue]="cat.categoryId">{{ cat.name }}
              </option>
            </select>
          </div>

          <!-- Modalidad -->
          <div class="col-md-6">
            <p class="form-p">Modalidad *</p>
            <select formControlName="modalityId" class="form-select form-select-sm">
              <option [ngValue]="null" disabled>Seleccione modalidad</option>
              <option *ngFor="let mod of selectedTournament?.modalities" [ngValue]="mod.modalityId">{{ mod.name }}
              </option>
            </select>
          </div>

          <!-- Estado -->
          <div class="col-md-6">
            <p class="form-p">Estado *</p>
            <select formControlName="status" class="form-select form-select-sm">
              <option [ngValue]="true">Activo</option>
              <option [ngValue]="false">Inactivo</option>
            </select>
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">Cancelar</button>
          <button type="submit" class="btn btn-success" [disabled]="teamForm.invalid">
            {{ idTeam ? 'Actualizar Equipo' : 'Guardar Equipo' }}
          </button>

        </div>
      </div>
    </form>
  </div>
</ng-template>


<!-- Modal: Nuevo Resultado -->
<ng-template #modalResult>
  <div class="modal-content">
    <div class="modal-header bg-primary text-white py-2 px-3 d-flex justify-content-between align-items-center">
      <h5 class="modal-title flex-grow-1 m-0">
        {{ idResult ? 'Editar' : 'Registrar' }} Resultado
      </h5>
      <button type="button" class="btn-close btn-close-white ms-2" aria-label="Close" (click)="closeModal()"
        style="filter: brightness(0) invert(1);">
      </button>
    </div>

    <div *ngIf="hasRegistrations; else noRegs">
      <form [formGroup]="resultForm" (ngSubmit)="saveResult()">
        <div class="modal-body">
          <div class="row g-3">
            <!-- Categoría -->
            <div class="col-md-6">
              <p class="form-p">Categoría *</p>
              <select class="form-select" formControlName="categoryId"
                [ngClass]="{ 'is-invalid': resultForm.controls['categoryId'].invalid && resultForm.controls['categoryId'].touched }">
                <option [ngValue]="null" disabled>Categoría...</option>
                <option *ngFor="let category of categories" [ngValue]="category.categoryId">
                  {{ category.name }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione una categoría.</div>
            </div>

            <!-- Modalidad -->
            <div class="col-md-6">
              <p class="form-p">Modalidad *</p>
              <select class="form-select" formControlName="modalityId"
                [ngClass]="{ 'is-invalid': resultForm.controls['modalityId'].invalid && resultForm.controls['modalityId'].touched }">
                <option [ngValue]="null" disabled>Modalidad...</option>
                <option *ngFor="let modality of modalities" [ngValue]="modality.modalityId">
                  {{ modality.name }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione una modalidad.</div>
            </div>

            <!-- Rama -->
            <div class="col-md-6">
              <p class="form-p">Rama *</p>
              <select class="form-select" formControlName="branchId"
                [ngClass]="{ 'is-invalid': resultForm.controls['branchId'].invalid && resultForm.controls['branchId'].touched }">
                <option [ngValue]="null" disabled>Seleccione rama...</option>
                <option *ngFor="let branch of branches" [ngValue]="branch.branchId">
                  {{ branch.name }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione una rama.</div>
            </div>

            <!-- Ronda -->
            <div class="col-md-6">
              <p class="form-p">Ronda *</p>
              <select class="form-select" formControlName="roundNumber"
                [ngClass]="{ 'is-invalid': resultForm.controls['roundNumber'].invalid && resultForm.controls['roundNumber'].touched }">
                <option [ngValue]="null" disabled>Ronda...</option>
                <option *ngFor="let round of roundNumbers" [ngValue]="round">
                  {{ round }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione una ronda.</div>
            </div>

            <!-- Jugador -->
            <div class="col-md-6">
              <p class="form-p">Jugador *</p>
              <select class="form-select" formControlName="personId"
                [ngClass]="{ 'is-invalid': resultForm.controls['personId'].invalid && resultForm.controls['personId'].touched }">
                <option [ngValue]="null" disabled>Jugador...</option>
                <option *ngFor="let player of uniquePlayers" [ngValue]="player.personId">
                  {{ player.personFullName }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione un jugador.</div>
            </div>

            <!-- Equipo -->
            <div class="col-md-6">
              <p class="form-p">Equipo</p>
              <select class="form-select" formControlName="teamId">
                <option [ngValue]="null">Sin equipo</option>
                <option *ngFor="let team of uniqueTeams" [ngValue]="team.teamId">
                  {{ team.nameTeam }}
                </option>
              </select>
            </div>

            <!-- Pista -->
            <div class="col-md-6">
              <p class="form-p">Pista *</p>
              <select class="form-select" formControlName="laneNumber"
                [ngClass]="{ 'is-invalid': resultForm.controls['laneNumber'].invalid && resultForm.controls['laneNumber'].touched }">
                <option [ngValue]="null" disabled>Pista...</option>
                <option *ngFor="let lane of laneNumbers" [ngValue]="lane.laneNumber">
                  {{ lane.laneNumber }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione una pista.</div>
            </div>

            <!-- Línea Jugada -->
            <div class="col-md-6">
              <p class="form-p">Línea Jugada *</p>
              <select class="form-select" formControlName="lineNumber"
                [ngClass]="{ 'is-invalid': resultForm.controls['lineNumber'].invalid && resultForm.controls['lineNumber'].touched }">
                <option [ngValue]="null" disabled>Línea...</option>
                <option *ngFor="let line of lineNumbers" [ngValue]="line.lineNumber">
                  {{ line.lineNumber }}
                </option>
              </select>
              <div class="invalid-feedback">Seleccione una línea jugada.</div>
            </div>

            <!-- Puntaje -->
            <div class="col-md-6">
              <p class="form-p">Puntaje *</p>
              <input formControlName="score" type="number" class="form-control" placeholder="Puntaje"
                [ngClass]="{ 'is-invalid': resultForm.controls['score'].invalid && resultForm.controls['score'].touched }" />
              <div class="invalid-feedback">Ingrese un puntaje válido.</div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">Cancelar</button>
            <button type="submit" class="btn btn-success" [disabled]="
                    resultForm.invalid ||
                    (!resultForm.value.personId && !resultForm.value.teamId) ||
                    (!resultForm.value.personId && resultForm.value.teamId)
                  ">
              Guardar
            </button>
          </div>
        </div>
      </form>
    </div>
    <ng-template #noRegs>
      <div class="alert alert-warning text-center m-3">
        No hay jugadores registrados en el torneo.
      </div>
    </ng-template>
  </div>
</ng-template>
